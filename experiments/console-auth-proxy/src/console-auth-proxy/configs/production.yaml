# Production configuration for Console Auth Proxy
server:
  listen_address: "0.0.0.0:8080"
  read_timeout: 30s
  write_timeout: 30s
  idle_timeout: 120s
  tls:
    enabled: true
    cert_file: "/etc/ssl/certs/tls.crt"
    key_file: "/etc/ssl/private/tls.key"

auth:
  auth_source: "oidc"  # or "openshift" for OpenShift OAuth
  issuer_url: "${CAP_ISSUER_URL}"  # Set via environment variable
  client_id: "${CAP_CLIENT_ID}"
  client_secret: "${CAP_CLIENT_SECRET}"
  redirect_url: "${CAP_REDIRECT_URL}"
  scope:
    - "openid"
    - "profile"
    - "email"
  success_url: "/"
  error_url: "/auth/error"
  cookie_path: "/"
  secure_cookies: true  # Always true in production with HTTPS
  
  # Cookie encryption keys (base64 encoded)
  # Generate with: openssl rand -base64 64
  cookie_authentication_key: "${CAP_COOKIE_AUTH_KEY}"
  cookie_encryption_key: "${CAP_COOKIE_ENCRYPT_KEY}"
  
  # TLS settings for auth provider connections
  tls:
    insecure_skip_verify: false  # Never skip in production
    server_name: ""              # Override SNI server name if needed
  
  kube_config:
    in_cluster: true  # Running in Kubernetes

proxy:
  backend:
    url: "${CAP_BACKEND_URL}"
    health_check_path: "/healthz"
    health_check_interval: 30s
  
  headers:
    user_header: "X-Forwarded-User"
    user_id_header: "X-Forwarded-User-ID"
    email_header: "X-Forwarded-Email"
    auth_header: "Authorization"
    auth_header_value: "bearer"
    
    custom:
      X-Proxy-Source: "console-auth-proxy"
      X-Environment: "production"
    
    remove:
      - "Cookie"
      - "X-Forwarded-For"  # Let the proxy set this
  
  timeouts:
    dial: 10s
    tls_handshake: 10s
    response_header: 30s
    expect_continue: 1s
    idle_conn: 90s
    max_idle_conns: 100
    max_idle_conns_per_host: 10
  
  tls:
    insecure_skip_verify: false
    server_name: ""              # Override SNI server name if needed
    ca_file: "/etc/ssl/ca/ca.crt"  # Custom CA if needed
    cert_file: ""                # Client certificate file if needed
    key_file: ""                 # Client private key file if needed

observability:
  metrics:
    enabled: true
    path: "/metrics"
  
  logging:
    level: "info"
    format: "json"  # Structured logging for production
    output: "stdout"
  
  health:
    enabled: true
    liveness_path: "/healthz"
    readiness_path: "/readyz"