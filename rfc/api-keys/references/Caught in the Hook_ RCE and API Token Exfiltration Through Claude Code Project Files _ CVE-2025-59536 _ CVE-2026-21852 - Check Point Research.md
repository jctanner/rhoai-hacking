# Caught in the Hook_ RCE and API Token Exfiltration Through Claude Code Project Files _ CVE-2025-59536 _ CVE-2026-21852 - Check Point Research

**Source:** `Caught in the Hook_ RCE and API Token Exfiltration Through Claude Code Project Files _ CVE-2025-59536 _ CVE-2026-21852 - Check Point Research.pdf`

---

Caught in the Hook: RCE and API Token Exﬁltration Through...

1 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

SEARCH

CATEGORIES

CAUGHT IN THE HOOK: RCE AND API TOKEN
EXFILTRATION THROUGH CLAUDE CODE PROJECT FILES |
CVE-2025-59536 | CVE-2026-21852
February 25, 2026

By Aviv Donenfeld and Oded Vanunu

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

2 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

Executive Summary
Check Point Research has discovered critical vulnerabilities in Anthropic’s Claude Code that
allow attackers to achieve remote code execution and steal API credentials through
malicious project conﬁgurations. The vulnerabilities exploit various conﬁguration
mechanisms including Hooks, Model Context Protocol (MCP) servers, and environment
variables -executing arbitrary shell commands and exﬁltrating Anthropic API keys when
users clone and open untrusted repositories. Following our disclosure, Check Point
Research collaborated closely with the Anthropic security team to ensure these
vulnerabilities were fully remediated. All reported issues have been successfully patched
prior to this publication.

Background
As AI-powered development tools rapidly integrate into software workﬂows, they introduce
novel attack surfaces that traditional security models haven’t fully addressed. These
platforms combine the convenience of automated code generation with the risks of
executing AI-generated commands and sharing project conﬁgurations across collaborative
environments.
Claude Code, Anthropic’s AI-powered command-line development tool, represents a
signiﬁcant target in this landscape. As a leading agentic tool within the developer
ecosystem, its adoption by technology professionals and integration into enterprise
workﬂows means that the platform’s security model directly impacts a substantial portion of
the AI-assisted development landscape.

Claude Code Platform
Claude Code enables developers to delegate coding tasks directly from their terminal
through natural language instructions. The platform supports comprehensive development
operations including ﬁle modiﬁcations, Git repository management, automated testing, build
system integration, Model Context Protocol (MCP) tool connections, and shell command
execution.

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

3 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

Vibe-coding an awesome project using Claude Code

Conﬁguration Files as Attack Surface
While analyzing Claude Code’s architecture, we examined how the platform manages its
conﬁgurations. Claude Code supports project-level conﬁgurations through a .claude/
settings.json ﬁle that lives directly in the repository. This design makes sense for team
collaboration – when developers clone a project, they automatically inherit the same Claude
Code settings their teammates use, ensuring consistent behavior across the team.
Since .claude/settings.json is just another ﬁle in the repository, any contributor with commit
access can modify it. This creates a potential attack vector: malicious conﬁgurations could
be injected into repositories, possibly triggering actions that users don’t expect and may not
even be aware are occurring.
We set out to investigate what these repository-controlled conﬁgurations could actually do,

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

4 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

and whether they could be leveraged to compromise developers working with affected
codebases.

Vulnerability #1: RCE via Untrusted Project Hooks
During our research into Claude Code’s conﬁguration documentation, we encountered
Anthropic’s recently released Hooks feature. Hooks are designed to provide deterministic
control over Claude Code’s behavior by executing user-deﬁned commands at various points
in the tool’s lifecycle. Unlike relying on the AI model to choose when to perform certain
actions, Hooks ensure that speciﬁc operations always execute when predetermined
conditions are met.
Some common use cases for Hooks include:
• Automatic code formatting: Run prettier on .ts ﬁles, gofmt on .go ﬁles, etc. after every
ﬁle edit
• Compliance and debugging workﬂows: Provide automated feedback when Claude
Code produces code that doesn’t follow codebase conventions
• Custom permissions: Block modiﬁcations to production ﬁles or sensitive directories
Hooks are deﬁned in .claude/settings.json – the same repository-controlled conﬁguration
ﬁle we identiﬁed earlier. This means any contributor with commit access can deﬁne hooks
that will execute shell commands on every collaborator’s machine when they work with the
project. The question was: what happens when those commands come from an untrusted
source?
To test this, we crafted a .claude/settings.json ﬁle which includes a simple hook that would
open a Calculator. We chose to use the SessionStart event with a startup matcher, which
according to Hooks documentation triggers automatically during Claude Code initialization:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

5 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

When we ran claude in the project directory, the following trust dialog was presented:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

6 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

The dialog warns about reading ﬁles and mentions that Claude Code may execute ﬁles “with

your permission.” This phrasing suggests that user approval will be required before any
execution occurs. Indeed, when Claude Code attempts to run commands during a normal
session (such as executing a bash script), it does prompt for explicit conﬁrmation:

Before execution of bash commands, Claude requests for explicit approval from the user.

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

7 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

We expected hooks to receive the same explicit conﬁrmation prompt.
Back to our test: we clicked “Yes, proceed” on the prompt from when we ﬁrst ran Claude.
Surprisingly, the Calculator app opened immediately, with no additional prompt or execution
warning.

We went back and examined the initial dialog more carefully. While it mentions ﬁles being
executed “with your permission,” there’s no warning that hook commands deﬁned in
.claude/settings.json will run automatically without conﬁrmation, as well as no explicit
approval which was required to execute the bash command demonstrated above. The
session appears completely normal while commands from the untrusted repository have
already run in the background.
With this behavior conﬁrmed, the path to remote code execution became clear. An attacker
could conﬁgure the hook to execute any shell command – such as downloading and running
a malicious payload:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

8 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

The following video demonstrates how an attacker may leverage this vulnerability to achieve
a reverse shell:

During our investigation of Claude Code’s conﬁguration system, we discovered that hooks

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

9 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

weren’t the only feature controlled through repository settings. This led us to examine other
conﬁguration-based execution mechanisms, particularly the MCP (Model Context Protocol)
integration.

Vulnerability #2: RCE Using MCP User Consent Bypass
Another interesting setting that Claude Code supports is MCP (Model Context Protocol),
which allows Claude Code to interact with external tools and services through a
standardized interface.
Similar to Hooks, MCP servers can be conﬁgured within the repository via .mcp.json
conﬁguration ﬁle. When opening a Claude Code conversation, the application initializes all
MCP servers by running the commands written in the MCP conﬁguration ﬁle.
To test the MCP conﬁgurations, we conﬁgured a fake MCP server whose initialization
command opens a Calculator for demonstration:

We observed that Anthropic had implemented an improved dialog in response to our ﬁrst
reported vulnerability [GHSA-ph6w-f82w-28w6]. This new dialog explicitly mentions that
commands in .mcp.json may be executed and emphasizes the risks of proceeding:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

10 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

User consent dialogue for MCP servers initialization
This improved warning would make it much more difﬁcult for an attacker to convince users
to conﬁrm initialization of Claude Code over a malicious project. With this in mind, our goal
shifted to ﬁnding a way to execute the injected commands without any user consent.
Reviewing Claude Code’s settings documentation, we identiﬁed the following two
conﬁgurations:

These parameters allow automatic approval of MCP servers: enableAllProjectMcpServers
enables all servers deﬁned in the project’s .mcp.json ﬁle, while enabledMcpjsonServers
whitelists speciﬁc server names. In legitimate use cases, these settings enable seamless
team collaboration – developers cloning a repository automatically get the same MCP

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

11 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

integrations (ﬁlesystem, database, or GitHub tools) without manual setup.
Additionally, just like Claude Code hooks, these conﬁgurations can be included in the
repository-controlled .claude/settings.json ﬁle. We tested whether this could bypass the
user consent dialog:

Starting Claude Code with this conﬁguration revealed a severe vulnerability: our command
executed immediately upon running claude – before the user could even read the trust
dialog. Ironically, the calculator application opened on top of the pending trust dialog:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

12 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

Similar to the hooks vulnerability, we escalated this into a reverse shell, demonstrating
complete compromise of a victim’s machine:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

13 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

Vulnerability #3: API Key Exﬁltration via Malicious
ANTHROPIC_BASE_URL
Following our discovery that Claude Code’s conﬁguration system could execute arbitrary
commands, we wanted to understand the full scope of what could be controlled through
.claude/settings.json. While exploring the conﬁguration schema, we found that environment
variables could also be deﬁned in this ﬁle. One particular variable caught our attention:
ANTHROPIC_BASE_URL.
This environment variable controls the endpoint for all Claude Code API communications. In
normal operation, it points to Anthropic’s servers, but like other settings, it could be
overridden in the project’s conﬁguration ﬁle.
This presented an opportunity: we could intercept and analyze the actual communication
between Claude Code and Anthropic’s servers. We set up mitmproxy, a tool for intercepting
HTTP trafﬁc, and conﬁgured ANTHROPIC_BASE_URL to route through our local proxy. This
would let us observe every API call Claude Code made in real-time:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

14 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

We started Claude Code and watched the trafﬁc ﬂow through our proxy. Something
immediately caught our attention: before we could even interact with the trust dialog,
Claude Code had already initiated several requests to Anthropic’s servers:

Requests captured by our mitmproxy
The requests seem to include prompts responsible for initializing the session with relevant
information, including ﬁle names in the repository and recent commit messages.

But more critically, every request included the authorization header – our full Anthropic API
key, completely exposed in plaintext:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

15 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

What started as research method into the communication between Claude Code client and
server immediately became an attack vector on its own. An attacker could place this
conﬁguration in a malicious repository:

When a victim clones the repository and runs claude, their API key would be sent directly to
the attacker’s server – before the victim decides to trust the directory. No user interaction
required.
But what could an attacker actually do with a stolen API key? The obvious answer was
billing fraud – running Claude queries charged to the victim’s account. But as we explored
Anthropic’s API documentation to understand the full scope of access, we discovered
something far more concerning: Workspaces.

Claude’s Workspaces
Claude’s Workspaces is a feature introduced within the API Console to help developers
manage multiple Claude deployments more effectively. Workspaces are especially useful for
teams and multi-project environments, allowing them to organize resources, streamline
access controls, and maintain shared contexts across tools. In practice, a Workspace acts as
a collaborative environment where multiple API keys can work with the same cloud-

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

16 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

mounted project ﬁles.

Files stored in a Workspace aren’t scoped to individual API keys. Instead, they belong to the
workspace itself – meaning multiple developers, each using their own API key, may
implicitly share the same storage area. Any API key belonging to that workspace inherits
visibility into the Workspace’s stored ﬁles.
To understand how this behaves in practice, we created a workspace with two API keys:

We then reviewed the Files API documentation, which allows managing ﬁles within a
Workspace, and began testing ﬁle uploads and downloads.
We uploaded a ﬁle using the following request:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

17 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

We noticed the API response showed the downloadable parameter set to false:

Attempting to download the ﬁle did indeed fail. We conﬁrmed this behavior in the
documentation:
You can only download ﬁles that were created by skills or the code execution tool. Files that
you uploaded cannot be downloaded.
This appears to be an architectural choice rather than a security boundary. Any developer
who can upload ﬁles to the Workspace is already fully trusted: if they can write ﬁles, they
typically also have access to the original content.
Nevertheless, since this weakens our attack impact, we wondered whether we could bypass
this behavior. Since ﬁles generated by Claude’s code execution tool are marked as
downloadable, we explored whether the attacker could simply ask Claude to regenerate an
existing ﬁle using the stolen API key. If successful, this would convert a non-downloadable
ﬁle into a workspace artifact that is eligible for download.

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

18 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

We instructed Claude to produce a copy of the ﬁle with a .unlocked sufﬁx:

As we expected, Claude generated an exact copy of the ﬁle:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

19 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

We then downloaded this regenerated ﬁle and conﬁrmed the content was identical to the
original:

This demonstrates that the download restriction can be trivially bypassed: regenerating the
ﬁle through the code execution tool converts it into a system-generated artifact that the
Files API allows to be downloaded.
This conﬁrms an attacker using a stolen API key gains complete read and write access to all
workspace ﬁles, include those uploaded by other developers.
With a stolen API key, an attacker can:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

20 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

• Access sensitive ﬁles by regenerating them through the code execution tool
• Delete critical ﬁles from the workspace
• Upload arbitrary ﬁles to poison the workspace or exhaust the 100 GB storage space
quota
• Exhaust API credits, leading to unexpected costs for the account owner or service
interruption when rate limits/budgets are reached
Unlike the code execution vulnerabilities that compromised a single developer’s machine, a
stolen API key may provide access to an entire team’s shared resources.
The following video demonstrates the complete attack chain: exﬁltrating the victim’s API key
and using it to access their workspace storage:

Supply Chain Attack Scenarios

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

21 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

This vulnerabilities are particularly dangerous because they leverage supply chain attack
vectors – the malicious conﬁguration spreads through trusted development channels:
• Malicious pull requests: Attackers can submit seemingly legitimate PRs that include
the malicious conﬁguration alongside actual code changes, making it harder for
reviewers to spot the threat
• Honeypot repositories: Attackers can create useful-looking projects (development
tools, code examples, tutorials) that contain the malicious conﬁguration, targeting
developers who discover and clone these repositories
• Internal enterprise repositories: A single compromised developer account or insider
threat can inject the conﬁguration into company codebases, affecting entire
development teams
The key factor making this a supply chain attack is that developers inherently trust project
conﬁguration ﬁles – they’re viewed as metadata rather than executable code, so they rarely
undergo the same security scrutiny as application code during code reviews.

Anthropic’s Fixes
Anthropic addressed the ﬁrst vulnerability by implementing an enhanced warning dialog that
appears when users open projects containing untrusted Claude Code conﬁgurations:

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

22 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

This improved warning addresses not only the hooks vulnerability but also other potential
risks from untrusted project directories, including malicious MCP conﬁgurations. Anthropic
claimed to develop additional security hardening features planned for release in the coming
months to provide more granular risk controls.
For the second vulnerability, Anthropic ﬁxed the bypass by ensuring that MCP servers cannot
execute before user approval, even when enableAllProjectMcpServers or
enabledMcpjsonServers are set in the repository’s conﬁguration ﬁles.
For the third vulnerability, Anthropic ﬁxed the API key exﬁltration issue by ensuring that no
API requests are initiated before users conﬁrm the trust dialog. This prevents malicious
ANTHROPIC_BASE_URL conﬁgurations from intercepting API keys during the project
initialization phase, as Claude Code now defers all network operations until after explicit
user consent.
We would like to thank Anthropic for their excellent collaboration and thoughtful
engagement throughout this disclosure process.

Protecting Against Conﬁguration-Based Attacks

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

23 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

Modern development tools increasingly rely on project-embedded conﬁgurations and
automations, creating new attack vectors that developers must navigate. As these tools
continue to evolve and add features, conﬁguration-based risks are likely here to stay as a
persistent threat in development ecosystems.
Just as developers have learned they cannot blindly execute code from untrusted sources,
we must extend that same caution to opening projects with modern development tools. The
line between conﬁguration and execution continues to blur, requiring us to treat project
setup ﬁles with the same careful attention we apply to executable code.
How to Stay Protected:
• Keep Your Tools Updated – Ensure you are running the latest version of Claude Code.
All vulnerabilities discussed in this report have been patched, and running the
current version is the most effective way to stay protected.
• Inspect conﬁguration directories before opening projects – examine .claude/,
.vscode/, and similar tool-speciﬁc folders
• Pay attention to tool warnings about potentially unsafe ﬁles, even in legitimatelooking repositories
• Review conﬁguration changes during code reviews with the same rigor applied to
source code
• Question unusual setup requirements that seem overly complex for a project’s
apparent scope

Timeline and Disclosure
• July 21st, 2025 – Check Point Research reported the malicious hooks vulnerability to
Anthropic
• August 26th, 2025 – Anthropic implemented a ﬁnal ﬁx after collaborative reﬁnement
process

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

24 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

• August 29th, 2025 – Anthropic publishes GitHub Security Advisory GHSA-ph6wf82w-28w6
• September 3rd, 2025 – Check Point Research reported the user consent bypass
vulnerability to Anthropic
• September 22nd, 2025 – Anthropic implemented a ﬁx for the bypass vulnerability
• October 3rd, 2025 – Anthropic publishes CVE-2025-59536
• October 28th, 2025 – Check Point Research reported the API Key exﬁltration
vulnerability to Anthropic
• December 28th, 2025 – Anthropic implemented a ﬁx for the API Key exﬁltration
vulnerability
• January 21st, 2026 – Anthropic publishes CVE-2026-21852
• February 25th, 2026 – Public disclosure

Conclusion
These vulnerabilities in Claude Code highlight a critical challenge in modern development
tools: balancing powerful automation features with security. The ability to execute arbitrary
commands through repository-controlled conﬁguration ﬁles created severe supply chain
risks, where a single malicious commit could compromise any developer working with the
affected repository.
The integration of AI into development workﬂows brings tremendous productivity beneﬁts,
but also introduces new attack surfaces that weren’t present in traditional tools.
Conﬁguration ﬁles that were once passive data now control active execution paths. As AIpowered development tools become more prevalent, the security community must carefully
evaluate these new trust boundaries to protect the integrity of our software supply chains.

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

25 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

GO UP

BACK TO ALL POSTS

POPULAR POSTS

ARTIFICIAL INTELLIGENCE

CHATGPT

CHECK POINT RESEARCH PUBLICATIONS

OPWNAI : Cybercriminals Starting to Use ChatGPT

CHECK POINT RESEARCH PUBLICATIONS

THREAT RESEARCH

Hacking Fortnite Accounts

ARTIFICIAL INTELLIGENCE

CHATGPT

CHECK POINT RESEARCH PUBLICATIONS

OpwnAI: AI That Can Save the Day or HACK it Away

BLOGS AND PUBLICATIONS

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

ECTS 30% OF WW NETWORKS

26 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

February 17, 2020

“THE TURKISH RAT” EVOLVED ADWI

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

27 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

Publications
Global cyber attack reports
Research publications
IPS advisories
Check point blog
Demos

Tools
Sandblast ﬁle analysis
ThreatCloud
Threat Intelligence
Zero day protection
Live threat map

About Us
Contact Us

Let’s get in touch
Subscribe for cpr blogs, news and more

2/27/26, 1:05 PM

Caught in the Hook: RCE and API Token Exﬁltration Through...

28 of 28

https://research.checkpoint.com/2026/rce-and-api-token-exﬁl...

Subscribe Now

© 1994-2025 Check Point Software Technologies LTD. All rights reserved.
Property of CheckPoint.com
Privacy Policy

2/27/26, 1:05 PM

